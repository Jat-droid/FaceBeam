<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ student_name }}'s Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            color: #adb5bd; 
            background-color: #121212; 
        }
        .profile-card, .content-card {
            background: #1e1e1e; 
            border-radius: 1rem;
            border: 1px solid #343a40; 
        }
        .student-name {
            font-family: 'Poppins', sans-serif; 
            font-weight: 600;
            font-size: 2.5rem; 
            color: transparent; 
            background-image: linear-gradient(135deg, #4B89FF, #1967D2); 
            -webkit-background-clip: text;
            background-clip: text;
            display: inline-block; 
        }
        .student-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
            border: 5px solid #343a40; 
        }
        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }
        .detail-item i {
            font-size: 1.2rem;
            color: #4B89FF; 
            width: 30px;
        }
        .form-select, .form-control {
            background-color: #2c2c2c; 
            color: #fff;
            border-color: #495057;
        }
        .form-select option {
            background-color: #1e1e1e; 
            color: #adb5bd;
        }
        .form-select:focus, .form-control:focus {
            background-color: #343a40;
            color: #fff;
            border-color: #4B89FF; 
            box-shadow: 0 0 0 0.25rem rgba(75, 137, 255, 0.25);
        }
        .progress {
             background-color: #343a40; 
        }
        .progress-bar {
            background-color: #4B89FF;
        }
         .alert-success { background-color: #198754; color: #fff; border: none; }
         .alert-danger { background-color: #dc3545; color: #fff; border: none; }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="row g-4">

            <!-- Left Column: Profile Card -->
            <div class="col-lg-4">
                <div class="profile-card p-4 text-center">
                    <img src="{{ url_for('student_photo', filename=image_filename) }}" alt="Photo of {{ student_name }}" class="student-img mb-3">
                    <h1 class="student-name">{{ student_name }}</h1>
                    <hr class="text-secondary">
                    <div class="text-start mt-4">
                        {% for key, value in details.items() if value %}
                        <div class="detail-item">
                            <i class="bi bi-dot me-2"></i> <!-- Simple dot icon -->
                            <div><strong>{{ key }}:</strong> {{ value }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    <button id="delete-student-btn" class="btn btn-outline-danger mt-4 btn-sm">Delete Student</button>
                </div>
                 <div class="text-center mt-3">
                    <a href="/" class="btn btn-outline-secondary btn-sm">‚Üê Back to Home</a>
                </div>
            </div>

            <!-- Right Column: Content Cards -->
            <div class="col-lg-8">
                <!-- Overall Attendance Card -->
                 <div class="content-card p-4 text-center">
                    <h5 class="text-secondary">Overall Attendance</h5>
                    <h1 class="display-3 fw-bold text-white">{{ attendance_percentage }}%</h1>
                    <div class="progress" style="height: 10px;">
                        {% set progress_width = attendance_percentage ~ '%' %}
                        <div class="progress-bar" role="progressbar" style="width: {{ progress_width }}" aria-valuenow="{{ attendance_percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>

                <!-- Check Status Card -->
                <div class="content-card p-4 mt-4">
                    <h3 class="mb-4 text-white">Check Attendance Status</h3>
                    <form method="POST" action="{{ url_for('student_dashboard', student_name=student_name) }}">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-5">
                                <label for="subject" class="form-label">Select Subject</label>
                                <select name="subject_id" id="subject" class="form-select" required>
                                    <option value="">Choose...</option>
                                    {% for subject in subjects %}
                                        <option value="{{ subject.id }}" {% if selected_subject|int == subject.id %}selected{% endif %}>{{ subject.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-5">
                                <label for="date" class="form-label">Select Date</label>
                                <input type="date" name="date" id="date" class="form-control" value="{{ selected_date }}" required>
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100">Check</button>
                            </div>
                        </div>
                    </form>
                    
                    {% if status %}
                    <div class="mt-4 text-center">
                        {% if status == 'Present' %}
                            <div class="alert alert-success fs-5" role="alert">Status: <strong>Present</strong></div>
                        {% else %}
                            <div class="alert alert-danger fs-5" role="alert">Status: <strong>Absent</strong></div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Delete button script 
        document.getElementById('delete-student-btn').addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this student?')) {
                const studentName = "{{ student_name }}";
                const encodedStudentName = encodeURIComponent(studentName);
                fetch(`/delete_student/${encodedStudentName}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) { alert(data.message); window.location.href = '/'; } 
                    else { alert('Error: Could not delete the student.'); }
                }).catch(error => { console.error('Error:', error); alert('An error occurred.'); });
            }
        });
    </script>
</body>
</html>

